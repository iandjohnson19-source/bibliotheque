<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reading with the Johnsons</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Inter:wght@300;400;500;600&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="screen active">
        <div class="login-container">
            <div class="login-header">
                <div class="logo-icon">
                    <svg viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 8C10 8 15 6 30 6C45 6 50 8 50 8V52C50 52 45 50 30 50C15 50 10 52 10 52V8Z" stroke="currentColor" stroke-width="2" fill="none"/>
                        <path d="M30 6V50" stroke="currentColor" stroke-width="2"/>
                        <path d="M16 16H26M16 22H24M16 28H26M16 34H22" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        <path d="M34 16H44M34 22H42M34 28H44M34 34H40" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                </div>
                <h1 class="login-title">Reading with the Johnsons</h1>
                <p class="login-subtitle">Our Reading Journey Together</p>
            </div>
            <div class="login-cards">
                <button class="login-card" onclick="app.showPasswordPrompt('partner1')">
                    <div class="login-card-avatar">
                        <svg viewBox="0 0 40 40" fill="none"><circle cx="20" cy="16" r="8" stroke="currentColor" stroke-width="2"/><path d="M6 36c0-8 6-14 14-14s14 6 14 14" stroke="currentColor" stroke-width="2" fill="none"/></svg>
                    </div>
                    <span class="login-card-name" id="partner1-login-name">Partner 1</span>
                    <span class="login-card-hint">View my books</span>
                </button>
                <button class="login-card" onclick="app.showPasswordPrompt('partner2')">
                    <div class="login-card-avatar">
                        <svg viewBox="0 0 40 40" fill="none"><circle cx="20" cy="16" r="8" stroke="currentColor" stroke-width="2"/><path d="M6 36c0-8 6-14 14-14s14 6 14 14" stroke="currentColor" stroke-width="2" fill="none"/></svg>
                    </div>
                    <span class="login-card-name" id="partner2-login-name">Partner 2</span>
                    <span class="login-card-hint">View my books</span>
                </button>
                <button class="login-card joint-card" onclick="app.navigateTo('joint')">
                    <div class="login-card-avatar">
                        <svg viewBox="0 0 40 40" fill="none"><circle cx="14" cy="14" r="6" stroke="currentColor" stroke-width="2"/><circle cx="26" cy="14" r="6" stroke="currentColor" stroke-width="2"/><path d="M2 34c0-7 5-12 12-12" stroke="currentColor" stroke-width="2" fill="none"/><path d="M38 34c0-7-5-12-12-12" stroke="currentColor" stroke-width="2" fill="none"/></svg>
                    </div>
                    <span class="login-card-name">Together</span>
                    <span class="login-card-hint">Our combined journey</span>
                </button>
            </div>
            <button class="settings-link" onclick="app.showSetup()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"/></svg>
                Setup &amp; Settings
            </button>
        </div>
    </div>

    <!-- Password Modal -->
    <div id="password-modal" class="modal-overlay" style="display:none">
        <div class="modal password-modal">
            <h2>Welcome back</h2>
            <p id="password-modal-name"></p>
            <form onsubmit="app.checkPassword(event)">
                <input type="password" id="password-input" placeholder="Enter your password" autocomplete="off">
                <div class="modal-actions">
                    <button type="button" class="btn btn-ghost" onclick="app.closePasswordModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Enter</button>
                </div>
            </form>
            <p id="password-error" class="error-text" style="display:none">Incorrect password</p>
        </div>
    </div>

    <!-- Setup Modal -->
    <div id="setup-modal" class="modal-overlay" style="display:none">
        <div class="modal setup-modal">
            <h2>Setup Your Space</h2>
            <p class="modal-description">Personalize your reading tracker</p>
            <form onsubmit="app.saveSetup(event)">
                <div class="setup-grid">
                    <div class="setup-section">
                        <h3>Partner 1</h3>
                        <label>Display Name
                            <input type="text" id="setup-name1" placeholder="e.g., Ian">
                        </label>
                        <label>Password
                            <input type="password" id="setup-pass1" placeholder="Set a password">
                        </label>
                        <label>Reading Goal (books/year)
                            <input type="number" id="setup-goal1" placeholder="e.g., 24" min="1">
                        </label>
                    </div>
                    <div class="setup-section">
                        <h3>Partner 2</h3>
                        <label>Display Name
                            <input type="text" id="setup-name2" placeholder="e.g., Hannah">
                        </label>
                        <label>Password
                            <input type="password" id="setup-pass2" placeholder="Set a password">
                        </label>
                        <label>Reading Goal (books/year)
                            <input type="number" id="setup-goal2" placeholder="e.g., 24" min="1">
                        </label>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-ghost" onclick="app.closeSetup()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Settings</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="app-screen" class="screen" style="display:none">
        <!-- Sidebar Navigation -->
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <svg viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg" width="28" height="28">
                        <path d="M10 8C10 8 15 6 30 6C45 6 50 8 50 8V52C50 52 45 50 30 50C15 50 10 52 10 52V8Z" stroke="currentColor" stroke-width="2" fill="none"/>
                        <path d="M30 6V50" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <span>The Johnsons</span>
                </div>
                <button class="sidebar-close" onclick="app.toggleSidebar()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
                </button>
            </div>
            <div class="sidebar-user" id="sidebar-user-info">
                <div class="sidebar-avatar" id="sidebar-avatar"></div>
                <div>
                    <div class="sidebar-username" id="sidebar-username">Guest</div>
                    <div class="sidebar-reading" id="sidebar-reading-count">0 books this year</div>
                </div>
            </div>
            <ul class="sidebar-nav">
                <li><a href="#" class="nav-link active" data-page="dashboard" onclick="app.navigateTo('dashboard')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
                    Dashboard</a></li>
                <li><a href="#" class="nav-link" data-page="my-books" onclick="app.navigateTo('my-books')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/></svg>
                    My Books</a></li>
                <li><a href="#" class="nav-link" data-page="add-book" onclick="app.navigateTo('add-book')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v8M8 12h8"/></svg>
                    Add Book</a></li>
                <li><a href="#" class="nav-link" data-page="challenges" onclick="app.navigateTo('challenges')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                    Challenges</a></li>
                <li class="nav-divider"></li>
                <li><a href="#" class="nav-link" data-page="joint" onclick="app.navigateTo('joint')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>
                    Together</a></li>
                <li><a href="#" class="nav-link" data-page="recap" onclick="app.navigateTo('recap')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20V10M18 20V4M6 20v-4"/></svg>
                    Year in Review</a></li>
                <li><a href="#" class="nav-link" data-page="recommendations" onclick="app.navigateTo('recommendations')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"/><path d="M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"/></svg>
                    Discover Books</a></li>
                <li class="nav-divider"></li>
                <li><a href="#" class="nav-link" data-page="data" onclick="app.navigateTo('data')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                    Backup &amp; Export</a></li>
            </ul>
            <div class="sidebar-footer">
                <button class="theme-toggle" onclick="app.toggleTheme()" title="Toggle dark mode">
                    <svg class="sun-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
                    <svg class="moon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
                </button>
                <button class="btn btn-ghost btn-sm" onclick="app.logout()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                    Switch User
                </button>
            </div>
        </nav>

        <!-- Mobile Header -->
        <header class="mobile-header">
            <button class="hamburger" onclick="app.toggleSidebar()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12h18M3 6h18M3 18h18"/></svg>
            </button>
            <span class="mobile-title">The Johnsons</span>
            <button class="theme-toggle-mobile" onclick="app.toggleTheme()">
                <svg class="sun-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
                <svg class="moon-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
            </button>
        </header>

        <!-- Main Content Area -->
        <main id="main-content" class="main-content">
            <!-- Pages get rendered here dynamically -->
        </main>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast" style="display:none"></div>

    <!-- Add Book Modal (used for editing too) -->
    <div id="book-modal" class="modal-overlay" style="display:none">
        <div class="modal book-modal">
            <div class="modal-header">
                <h2 id="book-modal-title">Add a New Book</h2>
                <button class="modal-close" onclick="app.closeBookModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
                </button>
            </div>
            <form id="book-form" onsubmit="app.saveBook(event)">
                <input type="hidden" id="book-id">
                <div class="form-grid">
                    <div class="form-group full-width autocomplete-wrapper">
                        <label for="book-title">Title *</label>
                        <input type="text" id="book-title" required placeholder="Start typing a book title..." autocomplete="off">
                        <div id="book-title-dropdown" class="autocomplete-dropdown" style="display:none"></div>
                        <div class="autocomplete-hint">Start typing to auto-fill book details from Open Library</div>
                    </div>
                    <div class="form-group full-width">
                        <label for="book-author">Author *</label>
                        <input type="text" id="book-author" required placeholder="Enter author name">
                    </div>
                    <div class="form-group">
                        <label for="book-pages">Total Pages</label>
                        <input type="number" id="book-pages" placeholder="e.g., 350" min="1">
                    </div>
                    <div class="form-group">
                        <label for="book-current-page">Current Page</label>
                        <input type="number" id="book-current-page" placeholder="e.g., 120" min="0">
                    </div>
                    <div class="form-group">
                        <label for="book-date-started">Date Started</label>
                        <input type="date" id="book-date-started">
                    </div>
                    <div class="form-group">
                        <label for="book-date-finished">Date Finished</label>
                        <input type="date" id="book-date-finished">
                    </div>
                    <div class="form-group">
                        <label for="book-genre">Genre</label>
                        <select id="book-genre">
                            <option value="">Select genre...</option>
                            <option value="Fiction">Fiction</option>
                            <option value="Non-Fiction">Non-Fiction</option>
                            <option value="Mystery">Mystery</option>
                            <option value="Thriller">Thriller</option>
                            <option value="Romance">Romance</option>
                            <option value="Sci-Fi">Sci-Fi</option>
                            <option value="Fantasy">Fantasy</option>
                            <option value="Horror">Horror</option>
                            <option value="Biography">Biography</option>
                            <option value="Memoir">Memoir</option>
                            <option value="Self-Help">Self-Help</option>
                            <option value="History">History</option>
                            <option value="Science">Science</option>
                            <option value="Philosophy">Philosophy</option>
                            <option value="Poetry">Poetry</option>
                            <option value="Business">Business</option>
                            <option value="Psychology">Psychology</option>
                            <option value="Travel">Travel</option>
                            <option value="Cooking">Cooking</option>
                            <option value="Art">Art</option>
                            <option value="Religion">Religion</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="book-rating">Rating</label>
                        <div class="star-rating" id="star-rating">
                            <span class="star" data-value="1">&#9733;</span>
                            <span class="star" data-value="2">&#9733;</span>
                            <span class="star" data-value="3">&#9733;</span>
                            <span class="star" data-value="4">&#9733;</span>
                            <span class="star" data-value="5">&#9733;</span>
                        </div>
                        <input type="hidden" id="book-rating" value="0">
                    </div>
                    <div class="form-group">
                        <label for="book-shelf">Shelf *</label>
                        <select id="book-shelf" required>
                            <option value="currently-reading">Currently Reading</option>
                            <option value="finished">Finished</option>
                            <option value="want-to-read">Want to Read</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="book-cover">Cover Image URL</label>
                        <input type="url" id="book-cover" placeholder="Paste image URL or leave blank">
                        <button type="button" class="btn btn-ghost btn-sm" onclick="app.searchCover()" style="margin-top:4px">Search Open Library</button>
                    </div>
                    <div class="form-group full-width">
                        <label for="book-notes">Notes</label>
                        <textarea id="book-notes" rows="3" placeholder="Your thoughts about this book..."></textarea>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-ghost" onclick="app.closeBookModal()">Cancel</button>
                    <button type="button" class="btn btn-danger" id="delete-book-btn" onclick="app.deleteBook()" style="display:none">Delete</button>
                    <button type="submit" class="btn btn-primary">Save Book</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Cover Search Modal -->
    <div id="cover-modal" class="modal-overlay" style="display:none">
        <div class="modal cover-modal">
            <h2>Search Book Cover</h2>
            <div class="cover-search-bar">
                <input type="text" id="cover-search-input" placeholder="Search by title or author...">
                <button class="btn btn-primary" onclick="app.performCoverSearch()">Search</button>
            </div>
            <div id="cover-results" class="cover-results"></div>
            <div class="modal-actions">
                <button class="btn btn-ghost" onclick="app.closeCoverModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
